<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>COVID-19 Vaccine Study Generator</title>
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: sans-serif;
      text-align: center;
      margin-top: 40px;
    }
    button {
      background: #1e90ff;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 1rem;
      margin-bottom: 20px;
    }
    #viewer {
      width: 80%;
      margin: 0 auto;
      background: #1b1b1b;
      border-radius: 8px;
      padding: 20px;
      text-align: left;
      line-height: 1.5;
    }
    h3 {
      color: #66b3ff;
    }
    a {
      color: #66b3ff;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .abstract {
      margin-top: 15px;
      color: #ddd;
    }
  </style>
</head>
<body>
  <h2>COVID-19 Vaccine Study Generator</h2>
  <p>Click below to generate a random peer-reviewed PubMed study. The data and abstract are fetched live from PubMedâ€™s open API.</p>
  <button id="randomBtn">Show Random Study</button>

  <div id="viewer">
    <p>No study loaded yet.</p>
  </div>

  <script>
    const ids = [
      "36060437",
      "9080027",
      "27515982",
      "39460349",
      "30335063",
      "36881788",
      "36837564",
      "26275795",
      "36335639",
      "38445666",
      "33275134",
      "36304385",
      "35228965",
      "35774715",
      "38138230",
      "12010171",
      "33515320",
      "37075917",
      "36746791",
       "34033732",
      "36788969",
      "35088968",
      "36120231",
      "39101197",
      "34957554",
      "35920797",
      "37456806",
      "38406008",
      "35818083",
      "35632497",
      "37243087",
      "37283622",
      "35980076",
      "36184535",
      "34659268",
      "35720324",
      "37873632",
      "35578586",
      "37193444",
      "38817489",
      "35306713",
      "36070946",
      "40195183",
      "35690533",
      "8642775",
      "8086806",
      "34176415",
      "34062319",
      "35038274",
      "39424883",
      "34020254",
      "35184205",
      "34327553",
      "34244448",
      "34365148",
      "35157188",
      "38933672",
      "37182082",
      "35568325",
      "37509537",
      "40351947",
      "37223456",
      "36445631",
      "39175548",
      "35326363",
      "34475124",
      "36245941",
      "36043937",
      "11074946",
      "35062778",
      "40184086",
      "38168524",
      "35361131",
      "37851648",
      "35737110",
      "36411077",
      "35216789",
      "37426444",
      "38005993",
      "9365509",
      "9254455",
      "8417681",
      "36332464",
      "9013428",
      "36574993",
      "35763914",
      "35891192",
      "36575011",
      "38469372",
      "37743511",
      "36298516",
      "35380028",
      "34945172",
      "37626783",
      "34888290",
      "36879263",
      "35763241",
      "35726807",
      "36041291",
      "39070394",
      "36795118",
      "35685829",
      "37198501",
      "38165067",
      "38415282",
      "37773092",
      "35050428",
      "39220747",
      "36686343",
      "37427078",
      "34668274",
      "35891229",
      "37231308",
      "37807809",
      "38887342",
      "36259114",
      "39767757",
      "9878050",
      "33835769",
      "9874608",
      "8427115",
      "8652629",
      "8282499",
      "34114256",
      "34114269",
      "35759681",
      "7906673",
      "34763263",
      "36851114",
      "8184125",
      "34480607",
      "35280277",
      "36840605",
      "37532545",
      "34700047",
      "36530641",
      "37377545",
      "35294664",
      "36536389",
      "38250842",
      "40156281",
      "34897152",
      "38315894",
      "38976886",
      "39927226",
      "39138276",
      "38401232",
      "35471572",
      "36357291",
      "34782941",
      "38160960",
      "40333295",
      "36371165",
      "35442390",
      "38400177",
      "40115753",
      "38974645",
      "34281357",
      "34185046",
      "34773533",
      "35110484",
      "37323744",
      "36658048",
      "37431875",
      "8313538",
      "38550316",
      "34730750",
      "35451293",
      "37817969",
      "36315834",
      "35308134",
      "35729514",
      "34988883",
      "36219335",
      "38605482",
      "35316551",
      "35936557",
      "36246778",
      "35175446",
      "37348045",
      "37308940",
      "35186342",
      "36098769",
      "40369546",
      "35585528",
      "36289118",
      "39739424",
      "36055601",
      "34782983",
      "39960599",
      "35246429",
      "36655832",
      "38299140",
      "33839200",
      "34835244",
      "35448837",
      "34763669",
      "36052319",
      "35354140",
      "37587055",
      "35372991",
      "35470996",
      "36592052",
      "39516206",
      "39529655",
      "37553599",
      "37074008",
      "38627989",
      "40289148",
      "37321898",
      "35978510",
      "34476603",
      "36177033",
      "37081683",
      "37489779",
      "39171563",
      "35292552",
      "36412746",
      "38212538",
      "39659558",
      "36723942",
      "34834458",
      "35979182",
      "36016204",
      "38314748",
      "39673711",
      "38403068",
      "36379527",
      "35291413",
      "37263519",
      "38932385",
      "36679925",
      "37870719",
      "35385678",
      "35562631",
      "37714559",
      "37941318",
      "38442131",
      "37244881",
      "36300183",
      "37514955",
      "35455266",
      "38645421",
      "40175816",
      "37559096",
      "39832761",
      "36414349",
      "35251600",
      "38654835",
      "35371700",
      "36340561",
      "39826014",
      "36387962",
      "36415713",
      "34351881",
      "35685560",
      "8995199",
      "35211310",
      "8862059",
      "37046504",
      "37933398",
      "34242687",
      "34342187",
      "37505405",
      "36291403",
      "36635139",
      "36841774",
      "34336436",
      "38932303",
      "37376503",
      "40321788",
      "39497564",
      "33783953",
      "8903477",
      "8787833",
      "8498927",
      "9044108",
      "8479648",
      "37727533",
      "39148725",
      "39772040",
      "39066428",
      "37192595",
      "38422745",
      "36376863",
      "38077842",
      "36051224",
      "36992160",
      "35069602",
      "38614963",
      "37973159",
      "36963124",
      "36931294",
      "34735684",
      "38299507",
      "37542216",
      "38769570",
      "34553641",
      "34954484",
      "35135929",
      "35088548",
      "37148041",
      "34921468",
      "38350771",
      "38222759",
      "39524914",
      "36372665",
      "34807361",
      "34835228",
      "36418848",
      "39508937",
      "35132836",
            "36288776",
      "37119215",
      "35865539",
      "36098903",
      "36532828",
      "36875094",
      "37587059",
      "34719776",
      "40006661",
      "38098543",
      "36397844",
      "10166255",
      "33987882",
      "35136010",
      "34373413",
      "36572989",
      "35122777",
      "34931412",
      "34779011",
      "39284920",
      "35417874",
      "35074300",
      "34973526",
      "35832214",
      "36381730",
      "35587834",
      "36877303",
      "39344100",
      "34783899",
      "35262410",
      "36636529",
      "38054147",
      "35850104",
      "36695552",
      "37406068",
      "34687421",
      "34185045",
      "36535825",
      "36305628",
      "36788908",
      "37319013",
      "36347818",
      "35540716",
      "37530946",
      "36070943",
      "39428534",
      "37771685",
      "38483787",
      "40046798",
      "37187649",
      "34100115",
      "35444915",
            "36851087",
      "35124725",
      "35275366",
      "34280507",
      "11082765",
      "40341709",
      "36846637",
      "36366292",
      "36422760",
      "36366397",
      "36505482",
      "34332438",
      "35507736",
      "10266499",
      "34293683",
      "34225251",
      "34717185",
      "35437965",
      "36415601",
      "37038664",
      "37942375",
      "39066388",
      "36177105",
      "35809159",
      "35316815",
      "34734259",
      "37976132",
      "37696225",
      "35479071",
      "36586226",
      "36873437",
      "35603763",
      "36298623",
      "34451973",
      "35830976",
      "8138749",
      "34088762",
      "34389692",
      "8346241",
      "36520464",
      "37071555",
      "40055620",
      "39638989",
      "38400164",
      "36799975",
      "35201275",
      "37594544",
      "37383526",
      "38140238",
      "36525812",
      "36537083",
      "39283432",
      "34670143",
      "35793501",
      "36819401",
      "39224893",
      "34839149",
      "36087300",
      "37668946",
      "37896974",
      "38455695",
      "40120088",
      "36592513",
      "35182269",
      "36351580",
      "39096515",
      "39610907"];

    async function fetchMetadata(id) {
      const res = await fetch(`https://api.ncbi.nlm.nih.gov/lit/ctxp/v1/pubmed/?format=csl&contenttype=json&id=${id}`);
      if (!res.ok) throw new Error("Metadata fetch failed");
      return res.json();
    }

    async function fetchAbstract(id) {
      const res = await fetch(`https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=${id}&retmode=xml`);
      if (!res.ok) throw new Error("Abstract fetch failed");
      const text = await res.text();
      const match = text.match(/<AbstractText[^>]*>([\s\S]*?)<\/AbstractText>/gi);
      if (!match) return "No abstract available.";
      return match.map(a => a.replace(/<\/?AbstractText[^>]*>/g, "")).join(" ");
    }

    document.getElementById("randomBtn").addEventListener("click", async () => {
      const randomId = ids[Math.floor(Math.random() * ids.length)];
      const viewer = document.getElementById("viewer");
      viewer.innerHTML = "<p>Loading study...</p>";

      try {
        const [meta, abstract] = await Promise.all([fetchMetadata(randomId), fetchAbstract(randomId)]);
        viewer.innerHTML = `
          <h3>${meta.title}</h3>
          <p><strong>Authors:</strong> ${(meta.author || []).map(a => a.family + " " + (a.given || "")).join(", ")}</p>
          <p><strong>Journal:</strong> ${meta["container-title"] || "Unknown"} (${meta.issued ? meta.issued["date-parts"][0][0] : "Unknown"})</p>
          <div class="abstract"><strong>Abstract:</strong><br>${abstract}</div>
          <p><a href="https://pubmed.ncbi.nlm.nih.gov/${randomId}/" target="_blank">Read full study on PubMed</a></p>
        `;
      } catch (err) {
        console.error(err);
        viewer.innerHTML = `<p>Error loading study. Please try again.</p>`;
      }
    });
  </script>
</body>
</html>
